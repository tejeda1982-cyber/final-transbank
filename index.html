<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TuMotoExpress - Cotizador</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }

body {
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#111;
  color:white;
  position:relative;
  overflow:hidden;
}

body::before {
  content:"";
  position:absolute;
  width:100%;
  height:100%;
  background:url('logo.png') center center no-repeat;
  background-size:350px;
  opacity:0.05;
  z-index:0;
}

.card {
  background:rgba(20,20,20,0.9);
  padding:30px;
  width:90%;
  max-width:420px;
  border-radius:20px;
  box-shadow:0 0 40px rgba(0,0,0,0.5);
  z-index:1;
}

h1 {
  text-align:center;
  margin-bottom:20px;
}

input {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  margin-bottom:15px;
  background:#222;
  color:white;
}

button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
}

.btn-cotizar {
  background:#ffcc00;
  color:black;
}

.btn-whatsapp {
  background:#25D366;
  color:white;
  display:none;
}

.resultado {
  margin-top:20px;
  line-height:1.6;
}
</style>
</head>

<body>

<div class="card">
  <h1>üöÄ Cotiza tu env√≠o</h1>

  <input id="inicio" placeholder="Direcci√≥n de retiro">
  <input id="destino" placeholder="Direcci√≥n de entrega">

  <button class="btn-cotizar" onclick="cotizar()">Calcular precio</button>

  <div class="resultado" id="resultado"></div>

  <button class="btn-whatsapp" id="btnWhatsapp">
    Aceptar y enviar por WhatsApp
  </button>
</div>

<!-- üëá AQU√ç PEGAS TU API KEY -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7ExvZ0pJBjs37LHwbOcWrUqpxg_V78mk&libraries=places"></script>

<script>
function initAutocomplete() {
  const options = {
    componentRestrictions: { country: "cl" },
    fields: ["formatted_address"]
  };

  new google.maps.places.Autocomplete(document.getElementById("inicio"), options);
  new google.maps.places.Autocomplete(document.getElementById("destino"), options);
}

window.onload = initAutocomplete;

async function cotizar() {
  const inicio = document.getElementById("inicio").value;
  const destino = document.getElementById("destino").value;

  const response = await fetch('/cotizar', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({inicio,destino})
  });

  const data = await response.json();
  const resultado = document.getElementById("resultado");
  const btnWhatsapp = document.getElementById("btnWhatsapp");

  if(data.error){
    resultado.innerHTML="‚ùå Error al calcular.";
    btnWhatsapp.style.display="none";
    return;
  }

  resultado.innerHTML = `
    üìç Distancia: ${data.distancia_km.toFixed(2)} km<br>
    üí∞ Neto: $${data.neto}<br>
    üßæ IVA: $${data.iva}<br>
    üí≥ <strong>Total: $${data.total}</strong>
  `;

  const mensaje = `Hola TuMotoExpress üëã
Quiero aceptar la cotizaci√≥n:

üìç Retiro: ${inicio}
üìç Entrega: ${destino}
üí≥ Total: $${data.total}

¬øPodemos coordinar?`;

  btnWhatsapp.style.display="block";

  // üëá CAMBIA POR TU N√öMERO REAL
  btnWhatsapp.onclick = () => {
    window.open(`https://wa.me/56942325524?text=${encodeURIComponent(mensaje)}`);
  };
}
</script>

</body>
</html>